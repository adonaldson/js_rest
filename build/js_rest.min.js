// js_rest.js version 0.2 (alpha) - http://github.com/dies-el/js_rest
(function(){var a=false,c=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(b){function d(){!a&&this.init&&this.init.apply(this,arguments)}var f=this.prototype;a=true;var g=new this;a=false;for(var e in b)g[e]=typeof b[e]=="function"&&typeof f[e]=="function"&&c.test(b[e])?function(h,i){return function(){var j=this._super;this._super=f[h];var k=i.apply(this,arguments);this._super=j;return k}}(e,b[e]):b[e];d.prototype=g;d.constructor=d;d.extend=arguments.callee;
return d}})();var Data=function(){};var View=function(){};View.Callback={invoke_callback:function(a,c){for(var b=View.Callback[a],d=0;d<b.length;d++)b[d](c)},after_update:[],after_save:[],after_destroy:[],after_error:[]};var Model=Class.extend({config:{name:"post",rest:{path:"posts"}},init:function(){this.data_source=Data[this.config.name];this.data={};this.ignored_fields=["id","updated_at","created_at"]},find:function(a){this.id=a;this.data=this.data_source[a]},to_params:function(){var a={};for(var c in this.data)this.ignored_fields.indexOf(c)>-1||(a[this.config.name+"["+c+"]"]=this.data[c]);return a},after_update:function(){View.Callback.invoke_callback("after_"+this.config.name+"_update",this);View.Callback.invoke_callback("after_update",
this)},after_save:function(){if(this.id==undefined){this.new_record=true;this.data_source[this.data.id]=this.data;this.find(this.data.id)}View.Callback.invoke_callback("after_"+this.config.name+"_save",this);View.Callback.invoke_callback("after_save",this)},after_destroy:function(){View.Callback.invoke_callback("after_"+this.config.name+"_destroy",this);View.Callback.invoke_callback("after_destroy",this)},after_error:function(a){this.errors=a;View.Callback.invoke_callback("after_"+this.config.name+
"_error",this);View.Callback.invoke_callback("after_error",this)},update:function(){this.after_update()},save:function(){var a=this,c=this.to_params();c.format="js";if(a.id==undefined)save_url="/"+a.config.rest.path+"/";else{c._method="put";save_url="/"+a.config.rest.path+"/"+a.id}$.ajax({type:"POST",url:save_url,data:c,success:function(b){if(a.id==undefined)a.data=JSON.parse(b);a.after_save()},error:function(b){b=JSON.parse(b.responseText);a.after_error(b)}})},destroy:function(){var a=this;$.ajax({type:"POST",
url:"/"+a.config.rest.path+"/"+a.id,data:{format:"js",_method:"delete"},success:function(){a.after_destroy()},error:function(){}})}});Model.register_callback=function(a){if(typeof View.Callback[a]=="undefined")View.Callback[a]=[]};Model.register_default_callbacks=function(a){Model.register_callback("after_"+a+"_update");Model.register_callback("after_"+a+"_save");Model.register_callback("after_"+a+"_destroy");Model.register_callback("after_"+a+"_error")};
Model.extract_id=function(a){if(a==undefined)return-1;return(a=a.match(/_(\d+)$/))&&a.length>1?parseInt(a[1],10):-1};Model.new_model_type=function(a){Model.register_default_callbacks(a.config.name);return Model.extend(a)};
